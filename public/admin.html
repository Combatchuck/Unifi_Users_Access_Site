<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="chart.js"></script>
    <style>
        .admin-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #dbeafe;
            background-color: #2563eb;
            padding: 20px;
            border-radius: 8px;
            margin: -20px -20px 30px -20px;
        }

        .admin-title h1 {
            color: white;
            margin: 0;
        }

        .status-badge {
            padding: 12px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 18px;
        }

        .status-healthy { background-color: #10b981; color: #ffffff; }
        .status-degraded { background-color: #fef08a; color: #713f12; }
        .status-alert { background-color: #fee2e2; color: #7f1d1d; }
        .status-critical { background-color: #fecaca; color: #991b1b; }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border: 1px solid #cffafe;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(6, 182, 212, 0.1);
        }

        .metric-card h3 {
            margin: 0 0 10px 0;
            color: #0891b2;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #06b6d4;
            margin: 10px 0;
        }

        .metric-subtext {
            font-size: 12px;
            color: #64748b;
        }

        .dashboard-section {
            background: white;
            border: 1px solid #cffafe;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(6, 182, 212, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0f8fa;
        }

        .section-header h2 {
            margin: 0;
            color: #06b6d4;
            font-size: 20px;
        }

        .refresh-btn {
            background-color: #06b6d4;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .refresh-btn:hover {
            background-color: #0891b2;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .data-table th {
            background-color: #e0f8fa;
            color: #0891b2;
            padding: 12px;
            text-align: left;
            font-weight: bold;
            border-bottom: 2px solid #cffafe;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #e0f8fa;
        }

        .data-table tr:hover {
            background-color: #f0fdf9;
        }

        .anomaly-row {
            background-color: #fef08a;
        }

        .error-rate-high {
            color: #dc2626;
            font-weight: bold;
        }

        .error-rate-med {
            color: #ea580c;
            font-weight: bold;
        }

        .error-rate-low {
            color: #16a34a;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            border: 3px solid #e0f8fa;
            border-top: 3px solid #06b6d4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert-box {
            background-color: #fef08a;
            border-left: 4px solid #ca8a04;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .alert-box.error {
            background-color: #fee2e2;
            border-left-color: #dc2626;
        }

        .alert-box h4 {
            margin: 0 0 5px 0;
            color: #92400e;
        }

        .alert-box.error h4 {
            color: #991b1b;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0f8fa;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #06b6d4;
            border-bottom-color: #06b6d4;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dark-mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            width: 50px;
            height: 26px;
            background-color: #cbd5e1;
            border-radius: 13px;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s;
        }

        .toggle-switch.on {
            background-color: #06b6d4;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background-color: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.on::after {
            left: 26px;
        }

        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }

        body.dark-mode .metric-card,
        body.dark-mode .dashboard-section {
            background-color: #2a2a2a;
            border-color: #3a3a3a;
            color: #e0e0e0;
        }

        body.dark-mode .metric-card h3 {
            color: #06b6d4;
        }

        body.dark-mode .metric-value {
            color: #06b6d4 !important;
        }

        body.dark-mode .metric-subtext {
            color: #cbd5e1 !important;
        }

        body.dark-mode .data-table th {
            background-color: #3a3a3a;
            color: #06b6d4;
            border-bottom-color: #4a4a4a;
        }

        body.dark-mode .data-table td {
            color: #e0e0e0;
        }

        body.dark-mode .dashboard-section h2 {
            color: #e0e0e0;
        }

        body.dark-mode .dashboard-section p,
        body.dark-mode .dashboard-section span {
            color: #cbd5e1 !important;
        }

        body.dark-mode .data-table td {
            border-bottom-color: #3a3a3a;
        }

        body.dark-mode .data-table tr:hover {
            background-color: #333333;
        }

        body.dark-mode .admin-header {
            border-bottom-color: #3a3a3a;
        }

        body.dark-mode .section-header {
            border-bottom-color: #3a3a3a;
        }

        /* Dark mode styles for new metric cards */
        body.dark-mode [style*="background: #dbeafe"] {
            background-color: #1e3a8a !important;
            color: #dbeafe !important;
        }

        body.dark-mode [style*="background: #cffafe"] {
            background-color: #164e63 !important;
            color: #cffafe !important;
        }

        body.dark-mode [style*="background: #d1fae5"] {
            background-color: #064e3b !important;
            color: #d1fae5 !important;
        }

        body.dark-mode [style*="background: #fef3c7"] {
            background-color: #78350f !important;
            color: #fef3c7 !important;
        }

        body.dark-mode [style*="background: #e9d5ff"] {
            background-color: #3f0f5c !important;
            color: #e9d5ff !important;
        }

        body.dark-mode [style*="background: #fee2e2"] {
            background-color: #7f1d1d !important;
            color: #fee2e2 !important;
        }

        body.dark-mode [style*="color: #1e40af"] {
            color: #dbeafe !important;
        }

        body.dark-mode [style*="color: #0e4e50"] {
            color: #cffafe !important;
        }

        body.dark-mode [style*="color: #065f46"] {
            color: #d1fae5 !important;
        }

        body.dark-mode [style*="color: #78350f"] {
            color: #fef3c7 !important;
        }

        body.dark-mode [style*="color: #5b21b6"] {
            color: #e9d5ff !important;
        }

        body.dark-mode [style*="color: #7f1d1d"] {
            color: #fee2e2 !important;
        }

        body.dark-mode h4 {
            color: #e0e0e0 !important;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <div class="admin-title">
                <h1>Admin Dashboard</h1>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span id="systemStatus" class="status-badge status-healthy">LOADING...</span>
                <button class="refresh-btn" onclick="refreshDashboard()">üîÑ Refresh</button>
            </div>
            <!-- LPR Capture controls removed -->
        </div>

        <!-- Main Metrics -->
        <div id="metricsContainer" class="metrics-grid">
            <div class="loading"><div class="spinner"></div>Loading metrics...</div>
        </div>

        <!-- Alerts Section -->
        <div id="alertsContainer" style="display: none;">
            <div id="alertsList"></div>
        </div>

        <!-- Detailed Dashboard Sections -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>API Health & Performance</h2>
                <button class="refresh-btn" onclick="refreshApiHealth()">Refresh</button>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('health')">Health Overview</button>
                <button class="tab" onclick="switchTab('endpoints')">Endpoint Stats</button>
                <button class="tab" onclick="switchTab('trends')">Trends</button>
            </div>

            <div id="health" class="tab-content active">
                <div class="chart-container">
                    <canvas id="healthChart"></canvas>
                </div>
            </div>

            <div id="endpoints" class="tab-content">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>Requests</th>
                            <th>Success Rate</th>
                            <th>Avg Response Time</th>
                            <th>Max Response Time</th>
                        </tr>
                    </thead>
                    <tbody id="endpointsList"></tbody>
                </table>
            </div>

            <div id="trends" class="tab-content">
                <div class="chart-container">
                    <canvas id="trendsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Security Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Security & Failed Logins</h2>
                <button class="refresh-btn" onclick="refreshFailedLogins()">Refresh</button>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchSecurityTab('summary')">Summary</button>
                <button class="tab" onclick="switchSecurityTab('anomalies')">Anomalies</button>
                <button class="tab" onclick="switchSecurityTab('timeline')">Timeline</button>
            </div>

            <div id="summary" class="tab-content active">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="metric-card">
                        <h3>Failed Attempts (24h)</h3>
                        <div class="metric-value" id="failedLoginCount">-</div>
                    </div>
                    <div class="metric-card">
                        <h3>Unique Users</h3>
                        <div class="metric-value" id="uniqueFailedUsers">-</div>
                    </div>
                    <div class="metric-card">
                        <h3>Anomalies Detected</h3>
                        <div class="metric-value" id="anomalyCount">-</div>
                    </div>
                    <div class="metric-card">
                        <h3>IP Threats</h3>
                        <div class="metric-value" id="ipThreats">-</div>
                    </div>
                </div>
            </div>

            <div id="anomalies" class="tab-content">
                <h3>Email Anomalies</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Attempts</th>
                            <th>Unique IPs</th>
                            <th>First Attempt</th>
                            <th>Last Attempt</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="emailAnomaliesList"></tbody>
                </table>

                <h3 style="margin-top: 25px;">IP-Based Anomalies</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>Attempts</th>
                            <th>Target Emails</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="ipAnomaliesList"></tbody>
                </table>
            </div>

            <div id="timeline" class="tab-content">
                <div class="chart-container">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Performance Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Performance Analytics</h2>
                <button class="refresh-btn" onclick="refreshPerformance()">Refresh</button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div class="metric-card">
                    <h3>Total Requests</h3>
                    <div class="metric-value" id="totalRequests">-</div>
                </div>
                <div class="metric-card">
                    <h3>Avg Latency</h3>
                    <div class="metric-value" id="avgLatency">-</div>
                    <div class="metric-subtext">milliseconds</div>
                </div>
                <div class="metric-card">
                    <h3>Bottleneck Endpoints</h3>
                    <div class="metric-value" id="bottleneckCount">-</div>
                </div>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Endpoint</th>
                        <th>Requests</th>
                        <th>Avg Latency</th>
                        <th>P95 Latency</th>
                        <th>P99 Latency</th>
                        <th>Slow Requests %</th>
                    </tr>
                </thead>
                <tbody id="performanceList"></tbody>
            </table>
        </div>


        <!-- Health & Uptime Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>System Health & Uptime</h2>
                <button class="refresh-btn" onclick="refreshHealthMetrics()">Refresh</button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div class="metric-card">
                    <h3>Uptime</h3>
                    <div class="metric-value" id="systemUptime">-</div>
                    <div class="metric-subtext" id="uptimePercent">-</div>
                </div>
                <div class="metric-card">
                    <h3>Error Rate (24h)</h3>
                    <div class="metric-value" id="errorRate24h">-</div>
                    <div class="metric-subtext">Failed requests</div>
                </div>
                <div class="metric-card">
                    <h3>Avg API Response</h3>
                    <div class="metric-value" id="avgResponseTime">-</div>
                    <div class="metric-subtext">milliseconds</div>
                </div>
            </div>

            <h3>Error Rate Trend (Last 24 Hours)</h3>
            <div class="chart-container" style="height: 300px;">
                <canvas id="errorTrendChart"></canvas>
            </div>

            <h3 style="margin-top: 25px;">Uptime Status</h3>
            <div id="uptimeStatus" style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 10px; color: #000000;">
                <p>Loading uptime data...</p>
            </div>
        </div>

        <!-- Database Monitoring Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Database Monitoring</h2>
                <button class="refresh-btn" onclick="refreshDatabaseHealth()">Refresh</button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div class="metric-card">
                    <h3>DB Status</h3>
                    <div class="metric-value" id="dbStatus">-</div>
                    <div class="metric-subtext">MongoDB Connection</div>
                </div>
                <div class="metric-card">
                    <h3>Active Connections</h3>
                    <div class="metric-value" id="activeConnections">-</div>
                    <div class="metric-subtext" id="connectionAverage">Avg: -</div>
                </div>
                <div class="metric-card">
                    <h3>Query Performance</h3>
                    <div class="metric-value" id="avgQueryTime">-</div>
                    <div class="metric-subtext">milliseconds</div>
                </div>
                <div class="metric-card">
                    <h3>Storage Used</h3>
                    <div class="metric-value" id="storageUsed">-</div>
                    <div class="metric-subtext" id="storageSummary">-</div>
                </div>
            </div>

            <h3>Database Performance Trend</h3>
            <div class="chart-container" style="height: 300px;">
                <canvas id="dbPerformanceChart"></canvas>
            </div>

            <h3 style="margin-top: 25px;">Operations Statistics</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody id="operationsStats">
                    <tr><td colspan="2">Loading...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- System Status Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>System Status</h2>
                <button class="refresh-btn" onclick="refreshSystemStatus()">Refresh</button>
            </div>

            <div id="statusDetails" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;"></div>
        </div>

        <!-- Session Management Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>üîê Session Management <span id="sessionCountBadge" style="background: #2563eb; color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px; margin-left: 10px;">0</span></h2>
                <div style="display: flex; gap: 10px;">
                    <button class="refresh-btn" onclick="refreshSessions()">Refresh</button>
                    <button class="refresh-btn" style="background: #dc2626;" onclick="revokeAllSessions()">üö´ Revoke All Sessions</button>
                </div>
            </div>

            <!-- Session Filters -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                <div>
                    <label style="font-size: 12px; color: #475569; font-weight: bold;">Search Email</label>
                    <input type="text" id="sessionEmailFilter" placeholder="Filter by email..." style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px;" onkeyup="filterSessions()">
                </div>
                <div>
                    <label style="font-size: 12px; color: #475569; font-weight: bold;">Filter by IP</label>
                    <input type="text" id="sessionIPFilter" placeholder="Filter by IP..." style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px;" onkeyup="filterSessions()">
                </div>
                <div style="display: flex; align-items: flex-end; gap: 5px;">
                    <button onclick="document.getElementById('sessionEmailFilter').value=''; document.getElementById('sessionIPFilter').value=''; filterSessions();" style="padding: 8px 12px; background: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 4px; cursor: pointer; font-size: 12px;">Clear Filters</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table class="metrics-table" style="border-collapse: separate; border-spacing: 0 8px;">
                    <thead>
                        <tr>
                            <th style="padding: 10px 15px;">Email</th>
                            <th style="padding: 10px 15px;">Login Time</th>
                            <th style="padding: 10px 15px;">Last Activity</th>
                            <th style="padding: 10px 15px;">Idle Time</th>
                            <th style="padding: 10px 15px;">IP Address</th>
                            <th style="padding: 10px 15px;">Action</th>
                        </tr>
                    </thead>
                    <tbody id="sessionsList">
                        <tr><td colspan="6" style="text-align: center; padding: 20px;">Loading sessions...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Comprehensive Metrics Sections -->
        
        <!-- User Activity Section -->
        <div class="dashboard-section">
            <h2>üë• User Activity</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #dbeafe; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #1e40af;">Active Users (7 days)</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #2563eb;" id="metric-activeUsers7d">-</p>
                </div>
                <div style="padding: 15px; background: #dbeafe; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #1e40af;">Active Users (30 days)</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #2563eb;" id="metric-activeUsers30d">-</p>
                </div>
                <div style="padding: 15px; background: #dbeafe; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #1e40af;">Actions Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #2563eb;" id="metric-actionsToday">-</p>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <canvas id="activityByDayChart" style="max-height: 300px;"></canvas>
            </div>
        </div>

        <!-- License Plates Section -->
        <div class="dashboard-section">
            <h2>üöó License Plates</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #cffafe; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #0e4e50;">Total Registered</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #06b6d4;" id="metric-totalPlates">-</p>
                </div>
                <div style="padding: 15px; background: #d1fae5; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #065f46;">Added Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #10b981;" id="metric-platesAddedToday">-</p>
                </div>
                <div style="padding: 15px; background: #fee2e2; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #7f1d1d;">Removed Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #ef4444;" id="metric-platesRemovedToday">-</p>
                </div>
            </div>
        </div>

        <!-- PIN Management Section -->
        <div class="dashboard-section">
            <h2>üîë PIN Management</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #fef3c7; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #78350f;">Changed Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #d97706;" id="metric-pinChangesToday">-</p>
                </div>
            </div>
        </div>

        <!-- Visitor Management Section -->
        <div class="dashboard-section">
            <h2>üë§ Visitor Management</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #e9d5ff; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #5b21b6;">Total Active Visitors</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #a855f7;" id="metric-totalVisitors">-</p>
                </div>
                <div style="padding: 15px; background: #d1fae5; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #065f46;">Modified Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #10b981;" id="metric-visitorsAddedToday">-</p>
                </div>
                <div style="padding: 15px; background: #fee2e2; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #7f1d1d;">Expiring Soon (7d)</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #ef4444;" id="metric-expiringVisitors">-</p>
                </div>
            </div>
            <div id="expiringVisitorsList" style="margin-top: 15px;"></div>
        </div>

        <!-- Authentication Health Section -->
        <div class="dashboard-section">
            <h2>üîê Authentication Health</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #fee2e2; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #7f1d1d;">Failed Logins (24h)</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #ef4444;" id="metric-failedLogins">-</p>
                </div>
                <div style="padding: 15px; background: #fecaca; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #7f1d1d;">Invalid Email Attempts (24h)</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #dc2626;" id="metric-invalidEmailAttempts">-</p>
                </div>
            </div>
        </div>

        <!-- Invitations Section -->
        <div class="dashboard-section">
            <h2>üìß Invitations</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #fef3c7; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #78350f;">Pending</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #d97706;" id="metric-pendingInvites">-</p>
                </div>
                <div style="padding: 15px; background: #d1fae5; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #065f46;">Sent Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #10b981;" id="metric-invitesSentToday">-</p>
                </div>
                <div style="padding: 15px; background: #d1fae5; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #065f46;">Accepted Today</p>
                    <p style="margin: 5px 0 0 0; font-size: 24px; font-weight: bold; color: #10b981;" id="metric-acceptedToday">-</p>
                </div>
            </div>
        </div>

        <!-- System Health Section -->
        <div class="dashboard-section">
            <h2>‚öôÔ∏è System Health</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="padding: 15px; background: #dbeafe; border-radius: 8px;">
                    <p style="margin: 0; font-size: 12px; color: #1e40af;">Last UniFi Sync</p>
                    <p style="margin: 5px 0 0 0; font-size: 14px; font-weight: bold; color: #2563eb;" id="metric-lastSync">-</p>
                </div>
                <!-- LPR Capture Service removed -->
            </div>
        </div>

        <!-- Top Users Section -->
        <div class="dashboard-section">
            <h2>üèÜ Top Users (Last 7 Days)</h2>
            <div style="overflow-x: auto;">
                <table class="metrics-table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="topUsersList">
                        <tr><td colspan="2" style="text-align: center; padding: 20px;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Top Actions Section -->
        <div class="dashboard-section">
            <h2>üìä Top Actions (Last 7 Days)</h2>
            <div style="overflow-x: auto;">
                <table class="metrics-table">
                    <thead>
                        <tr>
                            <th>Action</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody id="topActionsList">
                        <tr><td colspan="2" style="text-align: center; padding: 20px;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Audit Log Section -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>üìã Audit Log</h2>
                <button class="refresh-btn" onclick="refreshAuditLog()">Refresh</button>
            </div>

            <!-- Audit Log Filters -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                <div>
                    <label style="font-size: 12px; color: #475569; font-weight: bold;">Search Email</label>
                    <input type="text" id="auditEmailFilter" placeholder="Filter by email..." style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px;" onkeyup="filterAuditLogs()">
                </div>
                <div>
                    <label style="font-size: 12px; color: #475569; font-weight: bold;">Filter by Action</label>
                    <select id="auditActionFilter" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px;" onchange="filterAuditLogs()">
                        <option value="">All Actions</option>
                        <option value="PIN_CHANGED">PIN Changed</option>
                        <option value="PLATE_ADDED">License Plate Added</option>
                        <option value="PLATE_REMOVED">License Plate Removed</option>
                        <option value="INVITE_SENT">Invite Sent</option>
                        <option value="VISITOR_PLATE_ADDED">Visitor Plate Added</option>
                        <option value="VISITOR_PLATE_REMOVED">Visitor Plate Removed</option>
                        <option value="VISITOR_DELETED">Visitor Deleted</option>
                        <option value="SESSION_REVOKED">Session Revoked</option>
                        <option value="REVOKE_ALL_SESSIONS">Revoke All Sessions</option>
                    </select>
                </div>
                <div>
                    <label style="font-size: 12px; color: #475569; font-weight: bold;">Time Range</label>
                    <select id="auditTimeFilter" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px;" onchange="filterAuditLogs()">
                        <option value="all">All Time</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                        <option value="60d">Last 60 Days</option>
                        <option value="90d">Last 90 Days</option>
                    </select>
                </div>
                <div style="display: flex; align-items: flex-end; gap: 5px;">
                    <button onclick="document.getElementById('auditEmailFilter').value=''; document.getElementById('auditActionFilter').value=''; document.getElementById('auditTimeFilter').value='all'; filterAuditLogs();" style="padding: 8px 12px; background: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 4px; cursor: pointer; font-size: 12px;">Clear Filters</button>
                </div>
            </div>

            <div style="overflow-x: auto;">
                <table class="metrics-table" style="border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="padding: 12px 20px;">Timestamp</th>
                            <th style="padding: 12px 20px;">Email</th>
                            <th style="padding: 12px 20px;">Name</th>
                            <th style="padding: 12px 20px;">Action</th>
                            <th style="padding: 12px 20px;">Details</th>
                        </tr>
                    </thead>
                    <tbody id="auditLogList">
                        <tr><td colspan="5" style="text-align: center; padding: 20px;">Loading audit logs...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="header.js"></script>
    <script src="admin.js"></script>
</body>
</html>
